{
  "hash": "39d6b5471db7e39e73129c2f3ef18dc5",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Using OLGA to simulate T-cell receptor sequence diversity to assess genomic assay biases\"\ndescription: \"Use OLGA to simulate T-cell receptor sequence diversity as part of a workflow to understand & correct assay biases between production and in-development assay versions.\"\nauthor:\n  - name: Alice MacQueen\n    url: https://alice-macqueen.github.io/\n    orcid: 0000-0002-4606-1832\ndate: 2024-06-03\ncategories: [python, simulation] # self-defined categories\ncitation: \n  url: https://alice-macqueen.github.io/posts/2024-06-03-olga/\nimage: OLGA_Fig1.jpeg\ndraft: false # setting this to `true` will prevent your post from appearing on your listing page until you're ready!\nbibliography: references.bib\n---\n\n\nT-cell receptor (TCR) proteins are heterodimers, made up of one $\\alpha$ chain (TCRA) and one $\\beta$ chain (TCRB). These sequences each have several hypervariable regions, the most diverse of which is known as the [CDR3](https://en.wikipedia.org/wiki/Complementarity-determining_region). In TCRB sequences, the CDR3 is generated by recombination between three genomic sequences, a V-, D-, and J-gene. Up to $10^{15}$ distinct TCRs could, in principle, be formed by V-D-J recombination; this is an extremely large number (e.g., $10^{15}$ meters encompasses [our entire solar system to the Oort clouds](http://www.wordwizz.com/pages/1uexp15.htm)). About $4\\times10^{11}$ TCRs circulate in an adult human, and about $10^{10}$ of these have unique receptor sequences [@lythe2016]. In meters, $10^{11}$ meters encompasses about six weeks of Earth's orbit, and $10^{10}$ [about four days of Earth's orbit](http://www.wordwizz.com/pages/1uexp10.htm).\n\n![A V-, D-, and J- gene recombine to form the CDR3 region of each unique T-cell receptor sequence (\"clonotype\").](OLGA_Fig1.jpeg)\n\n[Adaptive's immunosequencing](https://www.adaptivebiotech.com/adaptive-immunosequencing/) platform has several assays to find the sequences of these hypervariable CDR3 regions. However, these assays differ in several important sequencing features, most importantly in the set of multiplexed PCR primers used to amplify the CDR3 region. Primer changes can lead to changes in cross-priming between assay versions, and these changes can cause consistent, recurrent sequence and gene annotation biases between these assay versions. These biases can cause strong false signals in downstream machine learning approaches such as disease modeling unless they are understood and corrected.\n\nTo measure and correct assay version-specific biases, I first simulated realistic CDR3 regions of varying lengths, then merged these simulated sequences to assay version-specific V-gene sequences. Fisher's exact tests on the number of V- & J- gene annotations in each assay were sufficient to reveal any biases between assay versions, after which I could explore workflow changes that reduced these assay biases.\n\nThe first step in this process is to simulate the CDR3 regions of the TCR sequences. To do this, I use the python package OLGA, which can generate CDR3 sequences using a generative model of V(D)J recombination.\n\n::: {.callout-note collapse=\"true\"}\n## Installing OLGA\n\nRun `pip install olga` in your terminal to install [OLGA](https://github.com/statbiophys/OLGA).\n:::\n\nOnce OLGA is installed it can be run from the command line. The following command generates 500K sequences (`-n 5e5`) using the default generative model settings for human TCRB sequences (`--humanTRB`) and saves them in the working directory to a file called simulated_tcrb.tsv (`-o simulated_tcrb.tsv`).\n\n```         \nalice@genegenie ~ % olga-generate_sequences --humanTRB -n 5e5 -o simulated_tcrb.tsv\n```\n\n```         \nStarting sequence generation... \n100000 sequences generated in 3.90 seconds. Estimated time remaining: 15.60 seconds.\n200000 sequences generated in 7.77 seconds. Estimated time remaining: 11.65 seconds.\n300000 sequences generated in 11.80 seconds. Estimated time remaining: 7.87 seconds.\n400000 sequences generated in 15.66 seconds. Estimated time remaining: 3.92 seconds.\n500000 sequences generated in 19.51 seconds. Estimated time remaining: 0.00 seconds.\nCompleted generating all 500000 sequences in 19.51 seconds.\n```\n\nLet's visualize the CDR3 sequences OLGA generated and look at some basic visualizations of the data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(knitr)\n# library(here)\n\ntcrb <- read_delim(\"simulated_tcrb.tsv\",\n  delim = \"\\t\",\n  col_names = c(\"CDR3_nt\", \"CDR3_aa\", \"V_gene\", \"J_gene\"), \n  col_types = \"cccc\"\n  )\n```\n:::\n\n\nThe default table that OLGA generates has four columns: the CDR3 nucleotide & amino acid sequences, and the V- and J-gene selected in V(D)J recombination to generate this CDR3 sequence. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ntcrb |>\n  head(n = 15) |>\n  kable()\n```\n\n::: {.cell-output-display}\n\n\n|CDR3_nt                                                      |CDR3_aa              |V_gene   |J_gene  |\n|:------------------------------------------------------------|:--------------------|:--------|:-------|\n|TGTGCCAGCAGGGTTGGGACCCTAGGAAACACCATATATTTT                   |CASRVGTLGNTIYF       |TRBV6-3  |TRBJ1-3 |\n|TGTGCCAGCAGCGGTCTAGACAGGCGGGGTCATAATTCACCCCTCCACTTT          |CASSGLDRRGHNSPLHF    |TRBV9    |TRBJ1-6 |\n|TGTGCCAGTAGTGAAGGGACTAGCGGGCCCTCCGGGGAGCTGTTTTTT             |CASSEGTSGPSGELFF     |TRBV19   |TRBJ2-2 |\n|TGTGCCAGCTTTATGGAGCGCTACGAGCAGTACTTC                         |CASFMERYEQYF         |TRBV7-6  |TRBJ2-7 |\n|TGCAGTGCGCCGGGAGGGGGGAACACTGAAGCTTTCTTT                      |CSAPGGGNTEAFF        |TRBV20-1 |TRBJ1-1 |\n|TGTGCCGGAAAGCCGGGACAGCGCAAGGGGCGCTCTGGAAACACCATATATTTT       |CAGKPGQRKGRSGNTIYF   |TRBV19   |TRBJ1-3 |\n|TGTGCCAGCAGCTGGGGGACCGGGGAGCTGTTTTTT                         |CASSWGTGELFF         |TRBV11-2 |TRBJ2-2 |\n|TGCAGTGCTAGAGATAAATCTGGACAGGGGTGTAGCAATCAGCCCCAGCATTTT       |CSARDKSGQGCSNQPQHF   |TRBV20-1 |TRBJ1-5 |\n|TGCAGTGCCCCTTACTATAACACTGAAGCTTTCTTT                         |CSAPYYNTEAFF         |TRBV20-1 |TRBJ1-1 |\n|TGTGCCAGCAGCCAAGATGGACAGAGCTCTGGAAACACCATATATTTT             |CASSQDGQSSGNTIYF     |TRBV4-2  |TRBJ1-3 |\n|TGCGCCAGCAGCTTGCCTACGCGGGAGGGCCAAGAGACCCAGTACTTC             |CASSLPTREGQETQYF     |TRBV5-1  |TRBJ2-5 |\n|TGTAGAAATTCCCTCATGAAAAACATTCAGTACTTC                         |CRNSLMKNIQYF         |TRBV6-5  |TRBJ2-4 |\n|TGTGCCACGCTCCCAGGTGGGCAGCCCCAGCATTTT                         |CATLPGGQPQHF         |TRBV12-3 |TRBJ1-5 |\n|TGCGCCAGCAGCTTGACCCCCACTAGCGGGAGTATGAGGAACACCGGGGAGCTGTTTTTT |CASSLTPTSGSMRNTGELFF |TRBV5-1  |TRBJ2-2 |\n|TGTGCCAGCAGCATACTGCAGAACGCCCAGCATTTT                         |CASSILQNAQHF         |TRBV3-1  |TRBJ1-5 |\n\n\n:::\n:::\n\n\nWhat are the lengths of these nucleotide sequences, and how many have each combination of V- and J-gene?\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntcrb <- tcrb |> \n  mutate(CDR3_nt_length = nchar(CDR3_nt)) \n\ntcrb |> \n  ggplot(aes(x = CDR3_nt_length)) +\n  geom_histogram(binwidth = 3) +\n  theme_classic(base_size = 12) +\n  labs(x = \"CDR3 length (nt)\", y = \"Count\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\nCDR3 from 24 to 75 nucleotides in length are represented in this dataset.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntcrb |> \n  ggplot(aes(x = J_gene, y = CDR3_nt_length)) + \n  geom_count() + \n  scale_size_area(max_size = 9) +\n  theme_classic(base_size = 12) +\n  theme(axis.text.x = element_text(hjust = 1, vjust = 1, angle = 45)) +\n  labs(x = \"J-gene\", y = \"CDR3 length (nt)\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\nSome J-genes are much more commonly used in the generative model, such as TCRBJ2-7. Many produce a similar range of CDR3 lengths, at least by eye; TCRBJ2-6 seems to create noticeably longer CDR3 on average.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntcrb |> \n  ggplot(aes(x = V_gene, y = CDR3_nt_length)) + \n  geom_count() + \n  scale_size_area(max_size = 6) +\n  theme_classic(base_size = 12) +\n  theme(axis.text.x = element_text(hjust = 1, vjust = 1, angle = 45)) +\n  labs(x = \"V-gene\", y = \"CDR3 length (nt)\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\nFinally, there is quite a range in the number of CDR3 generated using each V-gene in OLGA's generative model. V-genes like TCRBV16 are rarely used to make functional CDR3, while V-genes like TCRBV20-1 and TCRBV7-9 are very commonly used to generate CDR3. \n\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}